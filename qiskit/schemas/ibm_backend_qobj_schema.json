{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "id": "http://www.qiskit.org/schemas/ibm_backend_qobj_schema.json",
    "description": "OpenQuantum quantum object data structure for running experiments. IBM Backend specific instructions. Must also validate against qobj_schema.json",
    "version": "1.0.0",
    "definitions": {        
        "openqasm_instructions": {
            "oneOf": [
                { 
                    "properties": {
                        "name": {
                            "enum": ["snapshot", "reset", "barrier", "bfunc", "copy", "measure"]
                            }
                    }
                },
                {
                    "properties": {
                        "name": {
                            "enum": [
                                "wait",
                                "noise",
                                "save",
                                "load"
                            ]
                        }
                    },
                    "title": "Simulator specific instructions"
                },
                {
                    "properties": {
                        "memory": {
                            "maxItems": 0
                        },
                        "name": {
                            "enum": [
                                "u3",
                                "U"
                            ]
                        },
                        "params": {
                            "maxItems": 3,
                            "minItems": 3
                        },
                        "qubits": {
                            "maxItems": 1
                        },
                        "register": {
                            "maxItems": 0
                        },
                        "texparams": {
                            "maxItems": 3,
                            "minItems": 3
                        }
                    },
                    "required": [
                        "qubits",
                        "params"
                    ],
                    "title": "3-param 1Q op"
                },
                {
                    "properties": {
                        "memory": {
                            "maxItems": 0
                        },
                        "name": {
                            "enum": [
                                "id",
                                "h",
                                "s",
                                "sdg",
                                "t",
                                "tdg",
                                "x",
                                "y",
                                "z"
                            ]
                        },
                        "params": {
                            "maxItems": 0
                        },
                        "qubits": {
                            "maxItems": 1,
                            "minItems": 1
                        },
                        "register": {
                            "maxItems": 0
                        },
                        "texparams": {
                            "maxItems": 0
                        }
                    },
                    "required": [
                        "qubits"
                    ],
                    "title": "fixed 1Q op"
                },
                {
                    "properties": {
                        "memory": {
                            "maxItems": 0
                        },
                        "name": {
                            "enum": [
                                "u1",
                                "u0",
                                "rx",
                                "ry",
                                "rz"
                            ]
                        },
                        "params": {
                            "maxItems": 1,
                            "minItems": 1
                        },
                        "qubits": {
                            "maxItems": 1,
                            "minItems": 1
                        },
                        "register": {
                            "maxItems": 0
                        },
                        "texparams": {
                            "maxItems": 1,
                            "minItems": 1
                        }
                    },
                    "required": [
                        "qubits",
                        "params"
                    ],
                    "title": "1-param 1Q op"
                },
                {
                    "properties": {
                        "memory": {
                            "maxItems": 0
                        },
                        "name": {
                            "enum": [
                                "u2"
                            ]
                        },
                        "params": {
                            "maxItems": 2,
                            "minItems": 2
                        },
                        "qubits": {
                            "maxItems": 1,
                            "minItems": 1
                        },
                        "register": {
                            "maxItems": 0
                        },
                        "texparams": {
                            "maxItems": 2,
                            "minItems": 2
                        }
                    },
                    "required": [
                        "qubits",
                        "params"
                    ],
                    "title": "2-param 1Q op"
                },
                {
                    "properties": {
                        "memory": {
                            "maxItems": 0
                        },
                        "name": {
                            "enum": [
                                "cx",
                                "CX",
                                "cy",
                                "cz",
                                "ch",
                                "swap"
                            ]
                        },
                        "params": {
                            "maxItems": 0
                        },
                        "qubits": {
                            "description": "[control, target]",
                            "maxItems": 2,
                            "minItems": 2
                        },
                        "register": {
                            "maxItems": 0
                        },
                        "texparams": {
                            "maxItems": 0
                        }
                    },
                    "required": [
                        "qubits"
                    ],
                    "title": "fixed 2Q gate"
                },
                {
                    "properties": {
                        "memory": {
                            "maxItems": 0
                        },
                        "name": {
                            "enum": [
                                "cu1",
                                "crz",
                                "rzz"
                            ]
                        },
                        "params": {
                            "maxItems": 1,
                            "minItems": 1
                        },
                        "qubits": {
                            "description": "[control, target]",
                            "maxItems": 2,
                            "minItems": 2
                        },
                        "register": {
                            "maxItems": 0
                        },
                        "texparams": {
                            "maxItems": 1,
                            "minItems": 1
                        }
                    },
                    "required": [
                        "qubits",
                        "params"
                    ],
                    "title": "1-param 2Q controlled gate"
                },
                {
                    "properties": {
                        "memory": {
                            "maxItems": 0
                        },
                        "name": {
                            "enum": [
                                "cu3"
                            ]
                        },
                        "params": {
                            "maxItems": 3,
                            "minItems": 3
                        },
                        "qubits": {
                            "description": "[control, target]",
                            "maxItems": 2,
                            "minItems": 2
                        },
                        "register": {
                            "maxItems": 0
                        },
                        "texparams": {
                            "maxItems": 3,
                            "minItems": 3
                        }
                    },
                    "required": [
                        "qubits",
                        "params"
                    ],
                    "title": "3-param 2Q controlled gate"
                },
                {
                    "properties": {
                        "memory": {
                            "maxItems": 0
                        },
                        "name": {
                            "enum": [
                                "ccx",
                                "cswap"
                            ]
                        },
                        "params": {
                            "maxItems": 0
                        },
                        "qubits": {
                            "description": "[control, control, target]",
                            "maxItems": 3,
                            "minItems": 3
                        },
                        "register": {
                            "maxItems": 0
                        },
                        "texparams": {
                            "maxItems": 0
                        }
                    },
                    "required": [
                        "qubits"
                    ],
                    "title": "fixed 3Q doubly controlled gate"
                }           
            ],            
            "required": [
                "name"
            ],
            "type": "object"
        },
        "qobjexp": {
            "description": "Quantum experiment",
            "properties": {
                "instructions": {
                    "description": "List of experiment instructions.",
                    "minItems": 1,
                    "type": "array"
                }
            },
            "required": [
                "instructions"
            ],
            "type": "object"
        },
        "qobj_qasm": {
            "properties": {
                "config": {
                    "description": "Configuration options that apply to all experiments in this qobj. For options that may be set on a per-experiment basis, these are the defaults. Use this space to set backend specific configuration requirements.",
                    "title": "Qobj-level configuration",
                    "type": "object"
                },
                "experiments": {
                    "description": "List of experiments to run",
                    "minItems": 1,
                    "type": "array"
                },
                "header": {
                    "_constraints": "sum(x[1] for x in clbit_labels) == number_of_clbits",
                    "description": "QObj metadata that does not affect how the experiments are run on the backend. Carried through to the result.",
                    "properties": {
                        "backend_name": {
                            "description": "The backend this set of experiments was generated for. It may also be able to execute on other backends.",
                            "type": "string"
                        },
                        "backend_version": {
                            "description": "The backend version this set of experiments was generated for. ",
                            "type": "string"
                        },
                        "clbit_labels": {
                            "description": "A list of pairs [clreg_name, size], to allocate the next size contiguous clbits to clreg clreg_name. The sum of the size-s should equal register_slots",
                            "examples": [
                                [
                                    [
                                        "c",
                                        2
                                    ],
                                    [
                                        "d",
                                        3
                                    ]
                                ]
                            ],
                            "items": [
                                {
                                    "items": [
                                        {
                                            "minLength": 1,
                                            "title": "clreg",
                                            "type": "string"
                                        },
                                        {
                                            "description": "Size of the clreg",
                                            "minimum": 1,
                                            "title": "size",
                                            "type": "integer"
                                        }
                                    ],
                                    "maxItems": 2,
                                    "minItems": 2,
                                    "type": "array"
                                }
                            ],
                            "minItems": 1,
                            "title": "Map physical clbits to register_slots (for QASM)",
                            "type": "array",
                            "uniqueItems": true
                        },
                        "qubit_labels": {
                            "description": "A list of length n_qubits (from backend.configuration), where each element is either [qreg_name, n] to identify the corresponding physical qubit as the n-th qubit of qreg qreg_name, or null to identify that the corresponding physical qubit has no corresponding qreg",
                            "examples": [
                                [
                                    [
                                        "q",
                                        0
                                    ],
                                    [
                                        "q",
                                        1
                                    ],
                                    [
                                        "r",
                                        0
                                    ],
                                    [
                                        "r",
                                        1
                                    ],
                                    [
                                        "r",
                                        2
                                    ]
                                ],
                                [
                                    [
                                        "q",
                                        2
                                    ],
                                    null,
                                    [
                                        "q",
                                        1
                                    ],
                                    null,
                                    [
                                        "q",
                                        0
                                    ]
                                ]
                            ],
                            "items": {
                                "items": [
                                    {
                                        "minLength": 1,
                                        "title": "qreg",
                                        "type": "string"
                                    },
                                    {
                                        "description": "The qubit number within the qreg",
                                        "minimum": 0,
                                        "title": "qubit number",
                                        "type": "integer"
                                    }
                                ],
                                "maxItems": 2,
                                "minItems": 2,
                                "type": [
                                    "array",
                                    "null"
                                ]
                            },
                            "minItems": 1,
                            "title": "Map physical qubits to qregs (for QASM)",
                            "type": "array"
                        }
                    },
                    "type": "object"
                }
            },
            "required": [
                "type",
                "experiments",
                "config",
                "header"
            ],
            "type": "object"
        }
    },
    "oneOf": [
        {
            "allOf": [
                {
                    "$ref": "#/definitions/qobj_qasm"
                },
                {
                    "properties": {
                        "experiments": {
                            "items": {
                                "allOf": [
                                    {
                                        "$ref": "#/definitions/qobjexp"
                                    },
                                    {
                                        "properties": {
                                            "instructions": {
                                                "items": {
                                                    "$ref": "#definitions/openqasm_instructions"
                                                }
                                            }
                                        }
                                    }
                                ]
                            }
                        },
                        "type": {
                            "enum": [
                                "QASM"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "allOf": [
                {
                    "$ref": "#/definitions/qobj_qasm"
                },
                {
                    "properties": {"type": {"enum": ["PULSE"]}}
                }
            ]
        }
    ]
}
